<div class="stats-container">

  <div class="section-header">
    <h1>Resumen Operativo</h1>
    <span class="subtitle">Visión general del estudio</span>
  </div>

  <div class="kpi-grid">
    <mat-card class="kpi-card dashboard-card" *ngFor="let kpi of kpis">
      <div class="kpi-content">
        <div class="kpi-icon-container" [style.background-color]="kpi.color + '20'">
          <mat-icon [style.color]="kpi.color">{{kpi.icono}}</mat-icon>
        </div>
        <div class="kpi-data">
          <div class="kpi-value">{{kpi.valor}}</div>
          <div class="kpi-title">{{kpi.titulo}}</div>
        </div>
      </div>
    </mat-card>
  </div>

  <div class="charts-grid resumen-grid">
    <mat-card class="dashboard-card chart-card">
      <div class="card-header-simple">
        <h3>Ingresos Financieros</h3>
        <span class="text-muted">Tendencia últimos 6 meses</span>
      </div>
      <div class="chart-container">
        <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="'bar'"></canvas>
      </div>
    </mat-card>

    <mat-card class="dashboard-card chart-card">
      <div class="card-header-simple">
        <h3>Estado de Citas</h3>
        <span class="text-muted">Distribución actual</span>
      </div>
      <div class="chart-container">
        <canvas baseChart [data]="doughnutChartData" [options]="doughnutChartOptions" [type]="'doughnut'"></canvas>
      </div>
    </mat-card>
  </div>

  <div class="charts-grid">
    
    <mat-card class="kpi-card dashboard-card resumen-card" style="grid-column: span 2;">
      <div class="kpi-content justify-content-center">
        <div class="kpi-icon-container" [style.background-color]="'#4a2e1f' + '20'">
          <mat-icon [style.color]="'#4a2e1f'">compare_arrows</mat-icon>
        </div>
        <div class="kpi-data align-items-center">
          <div class="kpi-title mb-2">Comparación Financiera (Últimos 3 Meses)</div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; width: 100%;">
            <div style="text-align: center;">
              <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.25rem;">Pagos</div>
              <div style="font-size: 1.5rem; font-weight: 600; color: #2e7d32;">{{ totalPagos3MesesStr }}</div>
            </div>
            <div style="text-align: center;">
              <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.25rem;">Compras</div>
              <div style="font-size: 1.5rem; font-weight: 600; color: #d32f2f;">{{ totalCompras3MesesStr }}</div>
            </div>
            <div style="text-align: center; border-left: 2px solid #e0e0e0; padding-left: 1rem;">
              <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.25rem;">Total Combinado</div>
              <div style="font-size: 1.5rem; font-weight: 600; color: #4a2e1f;">{{ totalCombinado3MesesStr }}</div>
            </div>
          </div>
        </div>
      </div>
    </mat-card>

  </div>

  <div class="recent-activity mt-4">
    <mat-card class="dashboard-card">
      <div class="card-header-simple mb-2">
        <h3>Actividad & Alertas</h3>
      </div>
      <mat-card-content class="p-0">
        <mat-list>
          <div mat-subheader class="list-subheader">Próximas Citas</div>
          
          <mat-list-item class="activity-item" *ngFor="let cita of citasUrgentes">
            <mat-icon matListItemIcon class="activity-icon">event</mat-icon>
            <div matListItemTitle class="fw-bold">
              {{cita.cliente_nombre}} <span class="text-muted fw-normal" style="font-size: 0.85em;">(con {{cita.artista_nombre}})</span>
            </div>
            <div matListItemLine>
              {{cita.fecha_programada | date:'EEE dd MMM - HH:mm'}} • 
              <span class="text-uppercase" style="font-size: 0.75rem; font-weight: 700; color: #4a2e1f;">{{cita.estado}}</span>
            </div>
          </mat-list-item>

          <mat-list-item *ngIf="citasUrgentes.length === 0">
            <div matListItemTitle class="text-muted fst-italic">No hay citas programadas pronto.</div>
          </mat-list-item>

          <mat-divider></mat-divider>

          <div mat-subheader class="list-subheader text-danger">Alertas de Inventario</div>

          <mat-list-item class="activity-item" *ngFor="let material of materialesBajos">
            <mat-icon matListItemIcon class="activity-icon warning">notifications</mat-icon>
            <div matListItemTitle class="fw-bold">{{material.nombre}}</div>
            <div matListItemLine class="text-danger">
              Quedan {{material.cantidad_existencia}} unidades (Mínimo: {{material.nivel_reorden}})
            </div>
          </mat-list-item>

          <mat-list-item *ngIf="materialesBajos.length === 0">
            <div matListItemTitle class="text-success fst-italic">
              <mat-icon class="tiny-icon me-2">check_circle</mat-icon> 
              Inventario saludable.
            </div>
          </mat-list-item>

        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>

</div>