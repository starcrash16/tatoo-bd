<div class="resumen-container">

  <!-- Header con botón volver -->
  <div class="section-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1>Resumen de Cita</h1>
        <span class="subtitle">Detalles completos de la cita</span>
      </div>
      <button mat-flat-button class="back-btn" (click)="volver()">
        <mat-icon>arrow_back</mat-icon> VOLVER A CITAS
      </button>
    </div>
  </div>

  <!-- Mensaje de carga -->
  <div *ngIf="cargando" class="text-center py-5">
    <mat-icon class="loading-icon">hourglass_empty</mat-icon>
    <p class="mt-3">Cargando resumen...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="!cargando && !cita" class="text-center py-5">
    <mat-icon class="error-icon" color="warn">error_outline</mat-icon>
    <p class="mt-3">No se pudo cargar el resumen de la cita</p>
    <button mat-flat-button color="primary" (click)="volver()">
      Volver a Citas
    </button>
  </div>

  <!-- Contenido del resumen -->
  <div *ngIf="!cargando && cita" class="row">
    
    <!-- Columna Izquierda: Información General -->
    <div class="col-lg-4 mb-4">
      <mat-card class="profile-card">
        <mat-card-content>
          <div class="text-center mb-4">
            <div class="avatar-large">
              <mat-icon>event</mat-icon>
            </div>
            <h2 class="client-name mt-3">Cita #{{ cita.id || '-' }}</h2>
            <mat-chip-set class="justify-content-center mt-2">
                <mat-chip [class]="'status-' + (cita.estado?.toLowerCase() || 'programada')">
                    {{ cita.estado | uppercase }}
                </mat-chip>
            </mat-chip-set>
          </div>

          <mat-divider class="my-3"></mat-divider>

          <!-- Datos de la Cita -->
          <div class="info-section">
            <h3 class="section-title">
              <mat-icon>info</mat-icon> Detalles Generales
            </h3>
            
            <div class="info-row">
              <mat-icon class="info-icon">calendar_today</mat-icon>
              <div class="info-content">
                <span class="info-label">Fecha Programada</span>
                <span class="info-value">{{ cita.fecha_programada ? (cita.fecha_programada | date:'dd/MM/yyyy, h:mm a') : '-' }}</span>
              </div>
            </div>

            <div class="info-row" *ngIf="cita.duracion_estimada_minutos">
              <mat-icon class="info-icon">schedule</mat-icon>
              <div class="info-content">
                <span class="info-label">Duración</span>
                <span class="info-value">{{ cita.duracion_estimada_minutos }} minutos</span>
              </div>
            </div>

            <div class="info-row" *ngIf="cita.total_estimado">
              <mat-icon class="info-icon">attach_money</mat-icon>
              <div class="info-content">
                <span class="info-label">Total Estimado</span>
                <span class="info-value">{{ cita.total_estimado | currency }}</span>
              </div>
            </div>

            <div class="info-row">
              <mat-icon class="info-icon">label</mat-icon>
              <div class="info-content">
                <span class="info-label">Estado</span>
                <span class="badge" [ngClass]="{
                  'badge-pendiente': cita.estado?.toLowerCase() === 'programada',
                  'badge-confirmada': cita.estado?.toLowerCase() === 'confirmada',
                  'badge-cancelada': cita.estado?.toLowerCase() === 'cancelada',
                  'badge-completada': cita.estado?.toLowerCase() === 'completada'
                }">
                  {{ cita.estado | uppercase }}
                </span>
              </div>
            </div>

            <div class="info-row" *ngIf="cita.notas">
              <mat-icon class="info-icon">notes</mat-icon>
              <div class="info-content">
                <span class="info-label">Notas</span>
                <span class="info-value">{{ cita.notas }}</span>
              </div>
            </div>

          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Columna Derecha: Cliente, Artista y Diseño -->
    <div class="col-lg-8">
      
      <!-- Cliente y Artista -->
      <div class="row">
        <div class="col-md-6 mb-4">
            <mat-card class="info-card h-100">
                <mat-card-header>
                    <mat-card-title>
                      <mat-icon>person</mat-icon> Cliente
                    </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div class="info-row" *ngIf="clienteInfo">
                        <mat-icon class="info-icon">badge</mat-icon>
                        <div class="info-content">
                            <span class="info-label">Nombre Completo</span>
                            <span class="info-value">{{ clienteInfo.nombre }} {{ clienteInfo.apellido }}</span>
                        </div>
                    </div>
                    <div class="info-row" *ngIf="clienteInfo?.telefono">
                        <mat-icon class="info-icon">phone</mat-icon>
                        <div class="info-content">
                            <span class="info-label">Teléfono</span>
                            <span class="info-value">{{ clienteInfo.telefono }}</span>
                        </div>
                    </div>
                    <div class="info-row" *ngIf="clienteInfo?.email">
                        <mat-icon class="info-icon">email</mat-icon>
                        <div class="info-content">
                            <span class="info-label">Email</span>
                            <span class="info-value">{{ clienteInfo.email }}</span>
                        </div>
                    </div>
                    <div *ngIf="!clienteInfo" class="text-muted fst-italic p-2">
                      Cargando información del cliente...
                    </div>
                </mat-card-content>
            </mat-card>
        </div>

        <div class="col-md-6 mb-4">
            <mat-card class="info-card h-100">
                <mat-card-header>
                    <mat-card-title>
                      <mat-icon>brush</mat-icon> Artista
                    </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div class="info-row" *ngIf="artistaInfo">
                        <mat-icon class="info-icon">person</mat-icon>
                        <div class="info-content">
                            <span class="info-label">Nombre</span>
                            <span class="info-value">{{ artistaInfo.nombre_usuario }}</span>
                        </div>
                    </div>
                    <div class="info-row" *ngIf="artistaInfo?.email">
                        <mat-icon class="info-icon">email</mat-icon>
                        <div class="info-content">
                            <span class="info-label">Email</span>
                            <span class="info-value">{{ artistaInfo.email }}</span>
                        </div>
                    </div>
                    <div *ngIf="!artistaInfo" class="text-muted fst-italic p-2">
                      Cargando información del artista...
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
      </div>

      <!-- Diseño (solo si existe) -->
      <mat-card class="info-card mb-4" *ngIf="disenoInfo || cita.estado === 'confirmada' || cita.estado === 'completada'">
        <mat-card-header>
            <mat-card-title>
              <mat-icon>palette</mat-icon> Diseño
            </mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div *ngIf="disenoInfo">
              <div class="info-row">
                  <mat-icon class="info-icon">title</mat-icon>
                  <div class="info-content">
                      <span class="info-label">Título</span>
                      <span class="info-value">{{ disenoInfo.titulo }}</span>
                  </div>
              </div>
              <div class="info-row">
                  <mat-icon class="info-icon">category</mat-icon>
                  <div class="info-content">
                      <span class="info-label">Categoría</span>
                      <span class="info-value">{{ categoriaSeleccionada | titlecase }}</span>
                  </div>
              </div>
              <div class="info-row">
                  <mat-icon class="info-icon">attach_money</mat-icon>
                  <div class="info-content">
                      <span class="info-label">Precio Base</span>
                      <span class="info-value">${{ disenoInfo.precio_base }}</span>
                  </div>
              </div>
              <div class="info-row" *ngIf="disenoInfo.descripcion">
                  <mat-icon class="info-icon">description</mat-icon>
                  <div class="info-content">
                      <span class="info-label">Descripción</span>
                      <span class="info-value">{{ disenoInfo.descripcion }}</span>
                  </div>
              </div>
              <div *ngIf="disenoInfo.url_imagen" class="design-image-container mt-3">
                  <img [src]="disenoInfo.url_imagen" alt="Diseño del tatuaje" class="design-image">
              </div>
            </div>
            <div *ngIf="!disenoInfo" class="text-muted fst-italic p-2">
                No se ha seleccionado diseño para esta cita
            </div>
        </mat-card-content>
      </mat-card>

      <!-- Materiales (solo si existen) -->
      <mat-card class="info-card mb-4" *ngIf="materialesUsados && materialesUsados.length > 0">
        <mat-card-header>
            <mat-card-title>
              <mat-icon>inventory_2</mat-icon> Materiales Utilizados
            </mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Código</th>
                    <th>Material</th>
                    <th>Cantidad</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let mat of materialesUsados">
                    <td>{{ mat.codigo }}</td>
                    <td>{{ mat.nombre }}</td>
                    <td>{{ mat.cantidad }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </mat-card-content>
      </mat-card>

    </div>
  </div>
</div>
    <!-- trailing duplicate removed -->
