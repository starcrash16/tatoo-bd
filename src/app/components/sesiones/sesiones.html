<div class="citas-container fade-in"> <div class="section-header">
    <h1>Control de Sesiones</h1>
    <span class="subtitle">Monitoreo y búsqueda avanzada de sesiones de trabajo</span>
  </div>

  <mat-card class="custom-card mb-4">
    <mat-card-content>
      
      <form [formGroup]="filterForm" (ngSubmit)="buscar()">
        <div class="row align-items-center">
          
          <div class="col-md-2">
            <mat-form-field appearance="outline" class="w-100 custom-form-field">
              <mat-label>ID Cita</mat-label>
              <input matInput type="number" formControlName="id_cita" placeholder="#">
            </mat-form-field>
          </div>

          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100 custom-form-field">
              <mat-label>Estado</mat-label>
              <mat-select formControlName="estado">
                <mat-option value="">Todos</mat-option>
                <mat-option *ngFor="let estado of estadosSesion" [value]="estado">
                  {{ estado | uppercase }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100 custom-form-field">
              <mat-label>Artista</mat-label>
              <mat-select formControlName="id_artista">
                <mat-option value="">Todos</mat-option>
                <mat-option *ngFor="let artista of artistas" [value]="artista.id">
                  {{ artista.nombre_usuario }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100 custom-form-field">
              <mat-label>Cliente</mat-label>
              <mat-select formControlName="id_cliente">
                <mat-option value="">Todos</mat-option>
                <mat-option *ngFor="let cliente of clientes" [value]="cliente.id">
                  {{ cliente.nombre }} {{ cliente.apellido }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="col-md-1 d-flex justify-content-end gap-2">
            <button mat-icon-button type="submit" color="primary" matTooltip="Buscar" class="action-btn">
              <mat-icon>search</mat-icon>
            </button>
            <button mat-icon-button type="button" (click)="limpiarFiltros()" color="warn" matTooltip="Limpiar" class="action-btn">
              <mat-icon>restart_alt</mat-icon>
            </button>
          </div>

        </div>
      </form>

    </mat-card-content>
  </mat-card>

  <div class="table-container mat-elevation-z0">
    <table mat-table [dataSource]="dataSource" matSort>

      <ng-container matColumnDef="id_sesion">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Sesión # </th>
        <td mat-cell *matCellDef="let row"> #{{row.id_sesion}} ({{row.numero_sesion}}) </td>
      </ng-container>

      <ng-container matColumnDef="cita">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Cita </th>
        <td mat-cell *matCellDef="let row"> #{{row.id_cita}} </td>
      </ng-container>

      <ng-container matColumnDef="cliente">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Cliente </th>
        <td mat-cell *matCellDef="let row" class="fw-bold"> {{row.nombre_cliente}} </td>
      </ng-container>

      <ng-container matColumnDef="artista">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Artista </th>
        <td mat-cell *matCellDef="let row"> {{row.nombre_artista}} </td>
      </ng-container>

      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Programada </th>
        <td mat-cell *matCellDef="let row"> {{row.fecha_programada | date:'dd/MM/yyyy HH:mm'}} </td>
      </ng-container>

      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado </th>
        <td mat-cell *matCellDef="let row"> 
          <span [class]="'badge ' + (row.estado_sesion?.toLowerCase() || 'pendiente')">
            {{row.estado_sesion | uppercase}}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="duracion">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Duración </th>
        <td mat-cell *matCellDef="let row"> {{row.duracion_minutos ? row.duracion_minutos + ' min' : '--'}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center py-4" colspan="7">
          No se encontraron sesiones con esos criterios.
        </td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
  </div>

</div>